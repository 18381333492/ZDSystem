<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>特价话费</title>
    <!-- 引入 WeUI -->
    <link href="/WeUI/weui.min.css" rel="stylesheet" type="text/css" />
    <link href="/WeUI/jquery-weui.min.css" rel="stylesheet" type="text/css" />
    <script src="/WeUI/jquery.min.js" type="text/javascript"></script>
    <script src="/WeUI/jquery-weui.min.js" type="text/javascript"></script>

    <script src="/js/common.js" type="text/javascript"></script>
    <style>
         .weui-cells:after {
           border-bottom:none;
        }
        .nobored:before
        {
           border-top:none;
        }
        .weui-cell:before {
            right: 15px;
        }
        .mobile_focus{
            font-weight:600;
        }
        /*style的第一种样式*/
        .able_ul{
            list-style:none;
            width:100%;
        }
        .able_ul li{
            float:left;
            border:1px solid #FF4500;
            height:70px;
            text-align:center;
            width:29.1%;
            line-height:17.5px;
            border-radius:5px;
            margin-right:5%;
            margin-bottom:10px;
            color:#FF4500;
        }
        .able_ul li p{
            margin-top:17.5px;
        }
        .able_ul li span{
            font-size:10px;
        }
        /*style的第二种样式*/
        .unable_ul{
            list-style:none;
            width:100%;
        }
        .unable_ul li{
            float:left;
            border:1px solid #CACACA;
            height:70px;
            text-align:center;
            width:29.1%;
            line-height:70px;
            border-radius:5px;
            margin-right:5%;
            margin-bottom:10px;
            color:#CACACA;
        }
        .unable_ul li span{
            display:none;
            font-size:10px;
        }
        ul li:nth-child(3n+0)
        {
          margin-right:0%;
        }
        
:-moz-placeholder { /* Mozilla Firefox 4 to 18 */
    color: #FF4500; opacity:1; 
}

::-moz-placeholder { /* Mozilla Firefox 19+ */
    color: #FF4500;opacity:1;
}

input:-ms-input-placeholder{
    color:#FF4500;opacity:1;
}

input::-webkit-input-placeholder{
    color: #FF4500;opacity:1;
}
    </style>
</head>
<body ontouchstart style="background-color: #fff; margin-bottom:46px;">
    <img id="top" src="/hwwap/images/top.png" style=" width:100%" />
    <div class="weui-cells weui-cells_form nobored" style="margin-top: 0px;">
        <div class="weui-cell">
         <div style=" background-color:#FBF5F1; padding:15px 10px;border-radius: 4px">
            <div class="weui-cell__bd">
                <div style=" float:left; margin-right:15px; margin-left:15px; margin-top:4px;">
                 <img src="/hwwap/images/phone.png" style=" height:38px; width:28px;" />
                 </div>
                <input class="weui-input mobile_blur" type="tel" name="mobile" maxlength="13" placeholder="请输入手机号码" autofocus="autofocus"
                    style="height: 30px; font-size: 21px;width:65%">
                <a class="weui-icon-clear" style="display: inline-block;margin: auto;margin-bottom: 5px; display:none"></a>
                <input class="weui-input" id="tip" type="text" style="height: 16px; font-size: 12px;width:65%;float:left;
                    color: #ccc;display: inherit" readonly="readonly" value="移动 联通 电信">
            </div>
          </div>
        </div>
        <div class="weui-cell nobored">
            <div class="weui-cell__bd">
                <p style="height: 18px; font-size: 16px; font-weight:bold; margin-bottom: 15px;">特价话费<span style="color:#FF4500">8.66折</span>
                &nbsp;<span style=" font-size:14px; color:#999;font-weight:normal">(48小时内到账)</span></p>
                <div style="display: block; width: 100%">
                    <ul class="unable_ul">
                        <li>
                            <p>
                                50元</p>
                            <span>售价:99.99</span> </li>
                        <li>
                            <p>
                                100元</p>
                            <span>售价:99.99</span> </li>
                        <li>
                            <p>
                                200元</p>
                            <span>售价:99.99</span> </li>
                        <li>
                            <p>
                                300元</p>
                            <span>售价:99.99</span> </li>
                        <li>
                            <p>
                                500元</p>
                            <span>售价:99.99</span> </li>
                    </ul>
                </div>
            </div>
        </div>
         <div class="weui-cell">
            <div class="weui-cell__bd">
                <p style="height: 18px; font-size: 12px; margin-bottom:0px;color:#A1A1A1;">
                    温馨提示</p>
                <div style="display: block; width: 100%">
                   <p style=" font-size:12px; color:#A1A1A1;">
                   48小时内到账（节假日顺延），每位用户每月限充一次
                   </p>
                </div>
            </div>
        </div>
    </div>
    <!--bottom-->
    <div class="hw_bottom" style="font-size: 12px; background-color: #fff; padding-top: 3px;
        color: #0B346E; text-align: center; position: fixed; bottom: 0px; width: 100%; z-index:100">
        <a class="recharge_record">充值记录</a>
        <!--<a style="display: inline-block; border-right: 1px solid #0B346E;height: 10px; width: 1px;"></a>-->
        <a style="display: inline-block; background-color: #0B346E; margin: 0px 3px; margin-right: 4px;height: 10px; width: 1px;"></a>
           <a class="kehu_help">客服帮助</a>
          <a style="display: inline-block; background-color: #0B346E; margin: 0px 3px; margin-right: 4px;height: 10px; width: 1px;"></a>
           <a href="tel:4008111801" style="color:#0B346E">客服电话</a>
        <div style="margin-bottom: 5px;">
            <a style="display: inline-block; color: #91989F;">手机充值服务由四川千行你我科技有限公司提供</a>
        </div>
    </div>
</body>
</html>
<script src="/js/hwlogin.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {
        //图片的处理
        var width = $(window).width();
        $("#top").height(width / 2.8);

        localStorage.removeItem("payTip"); //清除缓存
        $('.kehu_help').on("click", function () {
            localStorage.setItem("recharge_mobile", $('input[name=mobile]').val());
            location.href = "/hwFAQ.html";
        });


        //跳转充值记录
        $('.recharge_record').on("click", function () {
            var account = hw_getInfo();
            if (account) {
                localStorage.setItem("recharge_mobile", $('input[name=mobile]').val());
                localStorage.setItem("recharge_account", account);
                location.href = "/hwquery.html";
            }
        });


        //清除输入框的值
        $('.weui-icon-clear').on("click", function () {
            $('input[name=mobile]').val('');
            $('input[name=mobile]').removeClass("mobile_focus");
            $(this).hide();
            //关闭效果    
            $('#tip').val("移动 联通 电信");
            $('#tip').css("color", "#ccc");
            if ($('ul').hasClass("able_ul")) {
                $('ul').removeClass("able_ul").addClass("unable_ul");
            }
            if ($('#other').hasClass("liuliang_able")) {
                $('#other').removeClass("liuliang_able").addClass("liuliang_unable");
            }
            $('input[name=mobile]').focus();
        });

        //页面初始化的时候进行
        $('input[name=mobile]').val(localStorage.getItem("recharge_mobile"));
        var ph = $('input[name=mobile]').val();
        if (ph.length == 13) {
            $('.weui-icon-clear').show();
            ph = ph.replace(/\D/g, '');
            LoadMobile(ph);
        }

        //失去焦点的时候
        $('input[name=mobile]').on("blur", function () {
            $('.hw_bottom').css("z-index", "10");
        });

        //获取焦点的时候
        $('input[name=mobile]').on("focus", function () {
            $('.hw_bottom').css("z-index", "-100");
        })

        //输入手机号码效果的切换
        $('input[name=mobile]').on("keyup", function (e) {
            var value = $(this).val();
            if (e.keyCode != 8) {
                if (/^[0-9]*$/.test(value.substr(value.length - 1, 1))) {
                    if (value.length == 4 || value.length == 9) {
                        var i = value.length;
                        value = client.string.insert(value, i - 1, " ");
                        $(this).val(value);
                    }
                }
                else {
                    $(this).val(value.substr(0, value.length - 1));
                    if ($(this).val().length == 0)
                        $(this).removeClass("mobile_focus");
                }
            }
            else {
                if (value.length == 9 || value.length == 4)
                    value = $(this).val(value.trim());
                if (value.length < 13) {
                    //关闭效果    
                    $('#tip').val("移动 联通 电信");
                    $('#tip').css("color", "#ccc");
                }
                if ($('ul').hasClass("able_ul")) {
                    $('ul').removeClass("able_ul").addClass("unable_ul");
                }
            }
        });

        //样式的切换
        $('input[name=mobile]').on("input", function () {
            var value = $(this).val();
            if (value.length > 0) $('.weui-icon-clear').show();
            if (!$(this).hasClass("mobile_focus")) {
                $(this).addClass("mobile_focus");
            }
            if (value.length == 0) {
                $('.weui-icon-clear').hide();
                $(this).removeClass("mobile_focus");
            }
            if (value.replace(/\D/g, '').length > 0 && client.regex.isPhone(value.replace(/\D/g, ''))) {
                //如果直接赋值号码
                value = value.replace(/\D/g, '');
                value = client.string.insert(value, 3, ' ');
                value = client.string.insert(value, 8, ' ');
                $(this).val(value);
            }
            if (value.trim().length == 13) {
                $('.weui-icon-clear').show();
                $(this).blur(); //失去焦点
                value = value.replace(/\D/g, '');
                //判断检查号码的区段
                if (client.regex.isPhone(value)) {
                    //interfaceType 1-获取好码归属地 2-获取产品
                    LoadMobile(value);
                }
                else {
                    setTimeout(function () {
                        $.toast("手机号码格式错误", "text");
                    }, 500);
                }
            }
        });

        var PhoneTip = '';
        //判断号码区段
        function LoadMobile(value) {
            client.ajax.ajaxRequest("/HWServer/MobileQuery.ashx", { sPhone: value, interfaceType: 1 }, function (r) {
                if (r.code == 100 && r.data.carrierNo) {
                    $('#tip').val('');
                    PhoneTip = r.data.provinceNo + r.data.carrierNo;
                    $('#tip').css("color", "#FF4500");
                    loadProduct(value);
                }
                else {
                    $.toast("不支持的号码", "cancel");
                }
            });
        }

        //根据产品ID获取产品
        function getProduct(productId) {
            var item = {};
            for (var i = 0; i < productArray.length; i++) {
                if (productArray[i].productID == productId) {
                    item = productArray[i];
                    break;
                }
            }
            return item;
        }

        var productArray = [];
        //根据手机号码加载产品列表
        function loadProduct(phone) {
            client.ajax.ajaxRequest("/HWServer/MobileQuery.ashx", { sPhone: phone, interfaceType: 2, businessType: 1, rm: 3 }, function (r) {
                if (r.code == 100) {
                    var array = r.data;
                    productArray = array;
                    var html = [];
                    $(array).each(function () {
                        html.push('<li data-productId="' + this.productID + '">');
                        html.push('<p>' + this.face + '元</p>');
                        html.push('<span>售价:' + this.payFee + '</span>');
                        html.push('</li>');
                    });
                    if (array.length > 0) {
                        $('#tip').val(PhoneTip);
                        $('ul').html('').append(html.join(''));
                        $('ul').removeClass("unable_ul").addClass("able_ul");
                        $('#other').removeClass("liuliang_unable").addClass("liuliang_able");

                        //绑定点击事件
                        $('ul li').on("click", function () {
                            if ($('ul').hasClass("able_ul")) {
                                var productId = $(this).attr("data-productId");
                                var item = getProduct(productId);
                                var face = item.face;
                                var fee = item.payFee;
                                var flow_type = item.flowType == null ? "null" : item.flowType;
                                var businessType = item.businessType;
                                var product_name = "慢充话费-" + face + "元";
                                var rechargeMode = item.rechargeMode;
                                //获取账户信息
                                var account =hw_getInfo();
                                if (account) {
                                    var show_mobile = client.string.insert(phone, 3, ' ');
                                    show_mobile = client.string.insert(show_mobile, 8, ' ');
                                    localStorage.setItem("recharge_mobile", show_mobile);
                                    localStorage.setItem("orderinfo", JSON.stringify({
                                        businessType: businessType,
                                        account: account, //华为生活账号
                                        product_name: product_name,
                                        mobile: phone, //充值的手机号
                                        product_id: productId, //产品编号
                                        face: face, //面值
                                        price: fee, //售价,
                                        card_type: 1, //充值类型 1-话费 2-流量
                                        flow_type: flow_type, //流量类型
                                        recharge_mode: rechargeMode //慢充类型
                                    }));
                                    location.href = "/slowpage/hwpayment.html";
                                }
                            }
                        });
                    }
                    else {
                        $('#tip').val("暂不支持" + PhoneTip + "用户充特价话费");
                        $('#tip').css("color", "#FF4500");
                    }
                } else {
                    $.toast(r.msg, "cancel");
                }
            });
        }
    });
</script>
